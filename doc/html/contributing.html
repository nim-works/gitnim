<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>Contributing</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);

  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark') {
      toggleSwitch.checked = true;
    }
  }
}
</script>

</head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">Contributing</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple-boot">
      <li>
        <a href="manual.html">Manual</a>
      </li>
      <li>
        <a href="lib.html">Standard library</a>
      </li>
      <li>
        <a href="theindex.html">Index</a>
      </li>
      <li>
        <a href="compiler/theindex.html">Compiler docs</a>
      </li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
    <div class="search-groupby">
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>

  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="writing-tests_toc" href="#writing-tests">Writing tests</a></li>
<ul class="simple"><li><a class="reference" id="writing-tests-stdlib_toc" href="#writing-tests-stdlib">Stdlib</a></li>
<li><a class="reference" id="writing-tests-compiler_toc" href="#writing-tests-compiler">Compiler</a></li>
</ul><li><a class="reference" id="running-tests_toc" href="#running-tests">Running tests</a></li>
<li><a class="reference" id="comparing-tests_toc" href="#comparing-tests">Comparing tests</a></li>
<li><a class="reference" id="deprecation_toc" href="#deprecation">Deprecation</a></li>
<li><a class="reference" id="documentation_toc" href="#documentation">Documentation</a></li>
<li><a class="reference" id="best-practices_toc" href="#best-practices">Best practices</a></li>
<li><a class="reference" id="the-git-stuff_toc" href="#the-git-stuff">The Git stuff</a></li>
<ul class="simple"><li><a class="reference" id="the-git-stuff-general-commit-rules_toc" href="#the-git-stuff-general-commit-rules">General commit rules</a></li>
<li><a class="reference" id="the-git-stuff-continuous-integration-ci_toc" href="#the-git-stuff-continuous-integration-ci">Continuous Integration (CI)</a></li>
<li><a class="reference" id="the-git-stuff-code-reviews_toc" href="#the-git-stuff-code-reviews">Code reviews</a></li>
</ul><li><a class="reference" id="documentation-style_toc" href="#documentation-style">Documentation Style</a></li>
<ul class="simple"><li><a class="reference" id="documentation-style-general-guidelines_toc" href="#documentation-style-general-guidelines">General Guidelines</a></li>
<li><a class="reference" id="documentation-style-moduleminuslevel-documentation_toc" href="#documentation-style-moduleminuslevel-documentation">Module-level documentation</a></li>
<li><a class="reference" id="documentation-style-procs-templates-macros-converters-and-iterators_toc" href="#documentation-style-procs-templates-macros-converters-and-iterators">Procs, Templates, Macros, Converters, and Iterators</a></li>
<li><a class="reference" id="documentation-style-types_toc" href="#documentation-style-types">Types</a></li>
<li><a class="reference" id="documentation-style-var-let-and-const_toc" href="#documentation-style-var-let-and-const">Var, Let, and Const</a></li>
</ul><li><a class="reference" id="evolving-the-stdlib_toc" href="#evolving-the-stdlib">Evolving the stdlib</a></li>
<ul class="simple"><li><a class="reference" id="evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib_toc" href="#evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib">What the compiler itself needs must be part of the stdlib</a></li>
<li><a class="reference" id="evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib_toc" href="#evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib">Vocabulary types must be part of the stdlib</a></li>
<li><a class="reference" id="evolving-the-stdlib-existing-battleminustested-modules-stay_toc" href="#evolving-the-stdlib-existing-battleminustested-modules-stay">Existing, battle-tested modules stay</a></li>
<li><a class="reference" id="evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules_toc" href="#evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules">Syntactic helpers can start as experimental stdlib modules</a></li>
<li><a class="reference" id="evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules_toc" href="#evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules">Other new stdlib modules do not start as stdlib modules</a></li>
<li><a class="reference" id="evolving-the-stdlib-little-additions-are-acceptable_toc" href="#evolving-the-stdlib-little-additions-are-acceptable">Little additions are acceptable</a></li>
</ul>
</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>Contributing happens via &quot;Pull requests&quot; (PR) on github. Every PR needs to be reviewed before it can be merged and the Continuous Integration should be green.</p>
<p>The PR has to be approved (and is often merged too) by one &quot;code owner&quot;, either by the code owner who is responsible for the subsystem the PR belongs to or by two core developers or by Araq.</p>
<p>See <a class="reference external" href="codeowners.html">codeowners</a> for more details.</p>

<h1><a class="toc-backref" id="writing-tests" href="#writing-tests">Writing tests</a></h1><p>There are 4 types of tests:</p>
<ol class="simple"><li><tt class="docutils literal"><span class="pre">runnableExamples</span></tt> documentation comment tests, ran by <tt class="docutils literal"><span class="pre">nim doc mymod.nim</span></tt> These end up in documentation and ensure documentation stays in sync with code.</li>
<li>separate test files, e.g.: <tt class="docutils literal"><span class="pre">tests/stdlib/tos.nim</span></tt>. In nim repo, <tt class="docutils literal"><span class="pre">testament</span></tt> (see below) runs all <tt class="docutils literal"><span class="pre">$nim/tests/*/t*.nim</span></tt> test files; for nimble packages, see <a class="reference external" href="https://github.com/nim-lang/nimble#tests">https://github.com/nim-lang/nimble#tests</a>.</li>
<li>(deprecated) tests in <tt class="docutils literal"><span class="pre">when isMainModule:</span></tt> block, ran by <tt class="docutils literal"><span class="pre">nim r mymod.nim</span></tt>. <tt class="docutils literal"><span class="pre">nimble test</span></tt> can run those in nimble packages when specified in a <tt class="docutils literal"><span class="pre">task &quot;test&quot;</span></tt>.</li>
<li>(not preferred) <tt class="docutils literal"><span class="pre">.. code-block:: nim</span></tt> RST snippets; these should only be used in rst sources, in nim sources <tt class="docutils literal"><span class="pre">runnableExamples</span></tt> should now always be preferred to those for several reasons (cleaner syntax, syntax highlights, batched testing, and <tt class="docutils literal"><span class="pre">rdoccmd</span></tt> allows customization).</li>
</ol>
<p>Not all the tests follow the convention here, feel free to change the ones that don't. Always leave the code cleaner than you found it.</p>

<h2><a class="toc-backref" id="writing-tests-stdlib" href="#writing-tests-stdlib">Stdlib</a></h2><p>Each stdlib module (anything under <tt class="docutils literal"><span class="pre">lib/</span></tt>, e.g. <tt class="docutils literal"><span class="pre">lib/pure/os.nim</span></tt>) should preferably have a corresponding separate test file, eg <tt class="docutils literal"><span class="pre">tests/stdlib/tos.nim</span></tt>. The old convention was to add a <tt class="docutils literal"><span class="pre">when isMainModule:</span></tt> block in the source file, which only gets executed when the tester is building the file.</p>
<p>Each test should be in a separate <tt class="docutils literal"><span class="pre">block:</span></tt> statement, such that each has its own scope. Use boolean conditions and <tt class="docutils literal"><span class="pre">doAssert</span></tt> for the testing by itself, don't rely on echo statements or similar; in particular avoid things like <tt class="docutils literal"><span class="pre">echo &quot;done&quot;</span></tt>.</p>
<p>Sample test:</p>
<pre class="listing"><span class="Keyword">block</span><span class="Punctuation">:</span> <span class="Comment"># bug #1234</span>
  <span class="Keyword">static</span><span class="Punctuation">:</span> <span class="Identifier">doAssert</span> <span class="DecNumber">1</span><span class="Operator">+</span><span class="DecNumber">1</span> <span class="Operator">==</span> <span class="DecNumber">2</span>

<span class="Keyword">block</span><span class="Punctuation">:</span> <span class="Comment"># bug #1235</span>
  <span class="Keyword">var</span> <span class="Identifier">seq2D</span> <span class="Operator">=</span> <span class="Identifier">newSeqWith</span><span class="Punctuation">(</span><span class="DecNumber">4</span><span class="Punctuation">,</span> <span class="Identifier">newSeq</span><span class="Punctuation">[</span><span class="Identifier">bool</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="DecNumber">2</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">doAssert</span> <span class="Identifier">seq2D</span> <span class="Operator">==</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">true</span><span class="Punctuation">,</span> <span class="Identifier">true</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">true</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
                      <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">]</span>
  <span class="Comment"># doAssert with `not` can now be done as follows:</span>
  <span class="Identifier">doAssert</span> <span class="Keyword">not</span> <span class="Punctuation">(</span><span class="DecNumber">1</span> <span class="Operator">==</span> <span class="DecNumber">2</span><span class="Punctuation">)</span></pre><p>Always refer to a github issue using the following exact syntax: <tt class="docutils literal"><span class="pre">bug #1234</span></tt> as shown above, so that it's consistent and easier to search or for tooling. Some browser extensions (eg <a class="reference external" href="https://github.com/sindresorhus/refined-github">https://github.com/sindresorhus/refined-github</a>) will even turn those in clickable links when it works.</p>
<p>Rationale for using a separate test file instead of <tt class="docutils literal"><span class="pre">when isMainModule:</span></tt> block:</p>
<ul class="simple"><li>allows custom compiler flags or testing options (see details below)</li>
<li>faster CI since they can be joined in <tt class="docutils literal"><span class="pre">megatest</span></tt> (combined into a single test)</li>
<li>avoids making the parser do un-necessary work when a source file is merely imported</li>
<li>avoids mixing source and test code when reporting line of code statistics or code coverage</li>
</ul>

<h2><a class="toc-backref" id="writing-tests-compiler" href="#writing-tests-compiler">Compiler</a></h2><p>The tests for the compiler use a testing tool called <tt class="docutils literal"><span class="pre">testament</span></tt>. They are all located in <tt class="docutils literal"><span class="pre">tests/</span></tt> (e.g.: <tt class="docutils literal"><span class="pre">tests/destructor/tdestructor3.nim</span></tt>). Each test has its own file. All test files are prefixed with <tt class="docutils literal"><span class="pre">t</span></tt>. If you want to create a file for import into another test only, use the prefix <tt class="docutils literal"><span class="pre">m</span></tt>.</p>
<p>At the beginning of every test is the expected behavior of the test. Possible keys are:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre">cmd</span></tt>: A compilation command template e.g. <tt class="docutils literal"><span class="pre">nim $target --threads:on $options $file</span></tt></li>
<li><tt class="docutils literal"><span class="pre">output</span></tt>: The expected output (stdout + stderr), most likely via <tt class="docutils literal"><span class="pre">echo</span></tt></li>
<li><tt class="docutils literal"><span class="pre">exitcode</span></tt>: Exit code of the test (via <tt class="docutils literal"><span class="pre">exit(number)</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">errormsg</span></tt>: The expected compiler error message</li>
<li><tt class="docutils literal"><span class="pre">file</span></tt>: The file the errormsg was produced at</li>
<li><tt class="docutils literal"><span class="pre">line</span></tt>: The line the errormsg was produced at</li>
</ul>
<p>For a full spec, see here: <tt class="docutils literal"><span class="pre">testament/specs.nim</span></tt></p>
<p>An example for a test:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
  errormsg: &quot;type mismatch: got (PTest)&quot;
&quot;&quot;&quot;</span>

<span class="Keyword">type</span>
  <span class="Identifier">PTest</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>

<span class="Keyword">proc</span> <span class="Identifier">test</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">PTest</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">nil</span>

<span class="Keyword">var</span> <span class="Identifier">buf</span><span class="Punctuation">:</span> <span class="Identifier">PTest</span>
<span class="Identifier">buf</span><span class="Operator">.</span><span class="Identifier">test</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre>
<h1><a class="toc-backref" id="running-tests" href="#running-tests">Running tests</a></h1><p>You can run the tests with</p>
<pre>
./koch tests</pre>
<p>which will run a good subset of tests. Some tests may fail. If you only want to see the output of failing tests, go for</p>
<pre>
./koch tests --failing all</pre>
<p>You can also run only a single category of tests. A category is a subdirectory in the <tt class="docutils literal"><span class="pre">tests</span></tt> directory. There are a couple of special categories; for a list of these, see <tt class="docutils literal"><span class="pre">testament/categories.nim</span></tt>, at the bottom.</p>
<pre>
./koch tests c lib # compiles/runs stdlib modules, including `isMainModule` tests
./koch tests c megatest # runs a set of tests that can be combined into 1</pre>
<p>To run a single test:</p>
<pre>
./koch test run &lt;category&gt;/&lt;name&gt;    # e.g.: tuples/ttuples_issues
./koch test run tests/stdlib/tos.nim # can also provide relative path</pre>
<p>For reproducible tests (to reproduce an environment more similar to the one run by Continuous Integration on travis/appveyor), you may want to disable your local configuration (e.g. in <tt class="docutils literal"><span class="pre">~/.config/nim/nim.cfg</span></tt>) which may affect some tests; this can also be achieved by using <tt class="docutils literal"><span class="pre">export XDG_CONFIG_HOME=pathtoAlternateConfig</span></tt> before running <tt class="docutils literal"><span class="pre">./koch</span></tt> commands.</p>

<h1><a class="toc-backref" id="comparing-tests" href="#comparing-tests">Comparing tests</a></h1><p>Test failures can be grepped using <tt class="docutils literal"><span class="pre">Failure:</span></tt>.</p>
<p>The tester can compare two test runs. First, you need to create the reference test. You'll also need to the commit id, because that's what the tester needs to know in order to compare the two.</p>
<pre>
git checkout devel
DEVEL_COMMIT=$(git rev-parse HEAD)
./koch tests</pre>
<p>Then switch over to your changes and run the tester again.</p>
<pre>
git checkout your-changes
./koch tests</pre>
<p>Then you can ask the tester to create a <tt class="docutils literal"><span class="pre">testresults.html</span></tt> which will tell you if any new tests passed/failed.</p>
<pre>
./koch tests --print html $DEVEL_COMMIT</pre>

<h1><a class="toc-backref" id="deprecation" href="#deprecation">Deprecation</a></h1><p>Backward compatibility is important, so instead of a rename you need to deprecate the old name and introduce a new name:</p>
<pre class="listing"><span class="Comment"># for routines (proc/template/macro/iterator) and types:</span>
<span class="Keyword">proc</span> <span class="Identifier">oldProc</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">float</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Punctuation">:</span>
    <span class="StringLit">&quot;deprecated since v1.2.3; use `newImpl: string -&gt; int` instead&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">discard</span>

<span class="Comment"># for (const/var/let/fields) the msg is not yet supported:</span>
<span class="Keyword">const</span> <span class="Identifier">Foo</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span>  <span class="Operator">=</span> <span class="DecNumber">1</span>

<span class="Comment"># for enum types, you can deprecate the type or some elements</span>
<span class="Comment"># (likewise with object types and their fields):</span>
<span class="Keyword">type</span> <span class="Identifier">Bar</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">enum</span> <span class="Identifier">bar0</span><span class="Punctuation">,</span> <span class="Identifier">bar1</span>
<span class="Keyword">type</span> <span class="Identifier">Barz</span>  <span class="Operator">=</span> <span class="Keyword">enum</span> <span class="Identifier">baz0</span><span class="Punctuation">,</span> <span class="Identifier">baz1</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">baz2</span></pre><p>See also <a class="reference external" href="manual.html#pragmas-deprecated-pragma">Deprecated</a> pragma in the manual.</p>

<h1><a class="toc-backref" id="documentation" href="#documentation">Documentation</a></h1><p>When contributing new procs, be sure to add documentation, especially if the proc is public. Even private procs benefit from documentation and can be viewed using <tt class="docutils literal"><span class="pre">nim doc --docInternal foo.nim</span></tt>. Documentation begins on the line following the <tt class="docutils literal"><span class="pre">proc</span></tt> definition, and is prefixed by <tt class="docutils literal"><span class="pre">##</span></tt> on each line.</p>
<p>Runnable code examples are also encouraged, to show typical behavior with a few test cases (typically 1 to 3 <tt class="docutils literal"><span class="pre">assert</span></tt> statements, depending on complexity). These <tt class="docutils literal"><span class="pre">runnableExamples</span></tt> are automatically run by <tt class="docutils literal"><span class="pre">nim doc mymodule.nim</span></tt> as well as <tt class="docutils literal"><span class="pre">testament</span></tt> and guarantee they stay in sync.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">addBar</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Adds &quot;Bar&quot; to `a`.</span>
  <span class="Identifier">runnableExamples</span><span class="Punctuation">:</span>
    <span class="Identifier">assert</span> <span class="StringLit">&quot;baz&quot;</span><span class="Operator">.</span><span class="Identifier">addBar</span> <span class="Operator">==</span> <span class="StringLit">&quot;bazBar&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">a</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot;Bar&quot;</span></pre><p>See <a class="reference external" href="os.html#parentDir,string">parentDir</a> example.</p>
<p>The RestructuredText Nim uses has a special syntax for including code snippets embedded in documentation; these are not run by <tt class="docutils literal"><span class="pre">nim doc</span></tt> and therefore are not guaranteed to stay in sync, so <tt class="docutils literal"><span class="pre">runnableExamples</span></tt> is usually preferred:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">someproc</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Return &quot;something&quot;</span>
  <span class="Comment">##</span>
  <span class="Comment">## .. code-block::</span>
  <span class="Comment">##  echo someproc() # &quot;something&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;something&quot;</span> <span class="Comment"># single-hash comments do not produce documentation</span></pre><p>The <tt class="docutils literal"><span class="pre">.. code-block:: nim</span></tt> followed by a newline and an indentation instructs the <tt class="docutils literal"><span class="pre">nim doc</span></tt> command to produce syntax-highlighted example code with the documentation (<tt class="docutils literal"><span class="pre">.. code-block::</span></tt> is sufficient from inside a nim module).</p>
<p>When forward declaration is used, the documentation should be included with the first appearance of the proc.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
  <span class="Comment">## Put documentation here</span>
<span class="Keyword">proc</span> <span class="Identifier">nothing</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">discard</span>
<span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## ignore this</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>The preferred documentation style is to begin with a capital letter and use the imperative (command) form. That is, between:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Return &quot;hello&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>or</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## says hello</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>the first is preferred.</p>

<h1><a class="toc-backref" id="best-practices" href="#best-practices">Best practices</a></h1><p>Note: these are general guidelines, not hard rules; there are always exceptions. Code reviews can just point to a specific section here to save time and propagate best practices.</p>
<p>New <tt class="docutils literal"><span class="pre">defined(foo)</span></tt> symbols need to be prefixed by the nimble package name, or by <tt class="docutils literal"><span class="pre">nim</span></tt> for symbols in nim sources (e.g. compiler, standard library). This is to avoid name conflicts across packages.</p>
<pre class="listing"><span class="Comment"># if in nim sources</span>
<span class="Keyword">when</span> <span class="Identifier">defined</span><span class="Punctuation">(</span><span class="Identifier">allocStats</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Keyword">discard</span> <span class="Comment"># bad, can cause conflicts</span>
<span class="Keyword">when</span> <span class="Identifier">defined</span><span class="Punctuation">(</span><span class="Identifier">nimAllocStats</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Keyword">discard</span> <span class="Comment"># preferred</span>
<span class="Comment"># if in a pacakge `cligen`:</span>
<span class="Keyword">when</span> <span class="Identifier">defined</span><span class="Punctuation">(</span><span class="Identifier">debug</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Keyword">discard</span> <span class="Comment"># bad, can cause conflicts</span>
<span class="Keyword">when</span> <span class="Identifier">defined</span><span class="Punctuation">(</span><span class="Identifier">cligenDebug</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Keyword">discard</span> <span class="Comment"># preferred</span></pre><p>Take advantage of no implicit bool conversion</p>
<pre class="listing"><span class="Identifier">doAssert</span> <span class="Identifier">isValid</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">true</span>
<span class="Identifier">doAssert</span> <span class="Identifier">isValid</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Comment"># preferred</span></pre><p>Design with method call syntax chaining in mind</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Identifier">cond</span><span class="Punctuation">:</span> <span class="Identifier">bool</span><span class="Punctuation">,</span> <span class="Identifier">lines</span><span class="Punctuation">:</span> <span class="Identifier">seq</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">)</span> <span class="Comment"># bad</span>
<span class="Keyword">proc</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Identifier">lines</span><span class="Punctuation">:</span> <span class="Identifier">seq</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Identifier">cond</span><span class="Punctuation">:</span> <span class="Identifier">bool</span><span class="Punctuation">)</span> <span class="Comment"># preferred</span>
<span class="Comment"># can be called as: `getLines().foo(false)`</span></pre><p>Use exceptions (including assert / doAssert) instead of <tt class="docutils literal"><span class="pre">quit</span></tt> rationale: <a class="reference external" href="https://forum.nim-lang.org/t/4089">https://forum.nim-lang.org/t/4089</a></p>
<pre class="listing"><span class="Identifier">quit</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Comment"># bad in almost all cases</span>
<span class="Identifier">doAssert</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Comment"># preferred</span></pre><p>Use <tt class="docutils literal"><span class="pre">doAssert</span></tt> (or <tt class="docutils literal"><span class="pre">require</span></tt>, etc), not <tt class="docutils literal"><span class="pre">assert</span></tt> in all tests so they'll be enabled even in release mode (except for tests in <tt class="docutils literal"><span class="pre">runnableExamples</span></tt> blocks which for which <tt class="docutils literal"><span class="pre">nim doc</span></tt> ignores <tt class="docutils literal"><span class="pre">-d:release</span></tt>).</p>
<pre class="listing"><span class="Keyword">when</span> <span class="Identifier">isMainModule</span><span class="Punctuation">:</span>
  <span class="Identifier">assert</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Comment"># bad</span>
  <span class="Identifier">doAssert</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Comment"># preferred</span></pre><p>Delegate printing to caller: return <tt class="docutils literal"><span class="pre">string</span></tt> instead of calling <tt class="docutils literal"><span class="pre">echo</span></tt> rationale: it's more flexible (e.g. allows caller to call custom printing, including prepending location info, writing to log files, etc).</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">echo</span> <span class="StringLit">&quot;bar&quot;</span> <span class="Comment"># bad</span>
<span class="Keyword">proc</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span> <span class="StringLit">&quot;bar&quot;</span> <span class="Comment"># preferred (usually)</span></pre><p>[Ongoing debate] Consider using Option instead of return bool + var argument, unless stack allocation is needed (e.g. for efficiency).</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Keyword">var</span> <span class="Identifier">Bar</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span>
<span class="Keyword">proc</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Option</span><span class="Punctuation">[</span><span class="Identifier">Bar</span><span class="Punctuation">]</span></pre><p>Tests (including in testament) should always prefer assertions over <tt class="docutils literal"><span class="pre">echo</span></tt>, except when that's not possible. It's more precise, easier for readers and maintaners to where expected values refer to. See for example <a class="reference external" href="https://github.com/nim-lang/Nim/pull/9335">https://github.com/nim-lang/Nim/pull/9335</a> and <a class="reference external" href="https://forum.nim-lang.org/t/4089">https://forum.nim-lang.org/t/4089</a></p>
<pre class="listing"><span class="Identifier">echo</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Comment"># adds a line for testament in `output:` block inside `discard`.</span>
<span class="Identifier">doAssert</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">2</span><span class="Punctuation">]</span> <span class="Comment"># preferred, except when not possible to do so.</span></pre>
<h1><a class="toc-backref" id="the-git-stuff" href="#the-git-stuff">The Git stuff</a></h1>
<h2><a class="toc-backref" id="the-git-stuff-general-commit-rules" href="#the-git-stuff-general-commit-rules">General commit rules</a></h2><ol class="simple"><li>Important, critical bugfixes that have a tiny chance of breaking somebody's code should be backported to the latest stable release branch (currently 1.2.x) and maybe also to the 1.0 branch. The commit message should contain the tag <tt class="docutils literal"><span class="pre">[backport]</span></tt> for &quot;backport to all stable releases&quot; and the tag <tt class="docutils literal"><span class="pre">[backport:$VERSION]</span></tt> for backporting to the given $VERSION.</li>
<li>If you introduce changes which affect backwards compatibility, make breaking changes, or have PR which is tagged as <tt class="docutils literal"><span class="pre">[feature]</span></tt>, the changes should be mentioned in <a class="reference external" href="https://github.com/nim-lang/Nim/blob/devel/changelog.md">the changelog</a>.</li>
<li><p>All changes introduced by the commit (diff lines) must be related to the subject of the commit.</p>
<p>If you change something unrelated to the subject parts of the file, because your editor reformatted automatically the code or whatever different reason, this should be excluded from the commit.</p>
<p><em>Tip:</em> Never commit everything as is using <tt class="docutils literal"><span class="pre">git commit -a</span></tt>, but review carefully your changes with <tt class="docutils literal"><span class="pre">git add -p</span></tt>.</p>
</li>
<li><p>Changes should not introduce any trailing whitespace.</p>
<p>Always check your changes for whitespace errors using <tt class="docutils literal"><span class="pre">git diff --check</span></tt> or add following <tt class="docutils literal"><span class="pre">pre-commit</span></tt> hook:</p>
<pre class="listing">
#!/bin/sh
git diff --check --cached || exit $?</pre></li>
</ol>
<ol class="simple"><li><p>Describe your commit and use your common sense. Example commit message:</p>
<p><tt class="docutils literal"><span class="pre">Fixes #123; refs #124</span></tt></p>
<p>indicates that issue <tt class="docutils literal"><span class="pre">#123</span></tt> is completely fixed (github may automatically close it when the PR is committed), wheres issue <tt class="docutils literal"><span class="pre">#124</span></tt> is referenced (e.g.: partially fixed) and won't close the issue when committed.</p>
</li>
<li><p>Commits should be always be rebased against devel (so a fast forward merge can happen)</p>
<p>e.g.: use <tt class="docutils literal"><span class="pre">git pull --rebase origin devel</span></tt>. This is to avoid messing up git history. Exceptions should be very rare: when rebase gives too many conflicts, simply squash all commits using the script shown in <a class="reference external" href="https://github.com/nim-lang/Nim/pull/9356">https://github.com/nim-lang/Nim/pull/9356</a></p>
</li>
<li>Do not mix pure formatting changes (e.g. whitespace changes, nimpretty) or automated changes (e.g. nimfix) with other code changes: these should be in separate commits (and the merge on github should not squash these into 1).</li>
</ol>

<h2><a class="toc-backref" id="the-git-stuff-continuous-integration-ci" href="#the-git-stuff-continuous-integration-ci">Continuous Integration (CI)</a></h2><ol class="simple"><li>Continuous Integration is by default run on every push in a PR; this clogs the CI pipeline and affects other PR's; if you don't need it (e.g. for WIP or documentation only changes), add <tt class="docutils literal"><span class="pre">[ci skip]</span></tt> to your commit message title. This convention is supported by <a class="reference external" href="https://www.appveyor.com/docs/how-to/filtering-commits/#skip-directive-in-commit-message">Appveyor</a> and <a class="reference external" href="https://docs.travis-ci.com/user/customizing-the-build/#skipping-a-build">Travis</a>.</li>
<li>Consider enabling CI (travis and appveyor) in your own Nim fork, and waiting for CI to be green in that fork (fixing bugs as needed) before opening your PR in original Nim repo, so as to reduce CI congestion. Same applies for updates on a PR: you can test commits on a separate private branch before updating the main PR.</li>
</ol>

<h2><a class="toc-backref" id="the-git-stuff-code-reviews" href="#the-git-stuff-code-reviews">Code reviews</a></h2><ol class="simple"><li>Whenever possible, use github's new 'Suggested change' in code reviews, which saves time explaining the change or applying it; see also <a class="reference external" href="https://forum.nim-lang.org/t/4317">https://forum.nim-lang.org/t/4317</a></li>
<li>When reviewing large diffs that may involve code moving around, github's interface doesn't help much as it doesn't highlight moves. Instead you can use something like this, see visual results <a class="reference external" href="https://github.com/nim-lang/Nim/pull/10431#issuecomment-456968196">here</a>:<pre class="listing">
git fetch origin pull/10431/head &amp;&amp; git checkout FETCH_HEAD
git diff --color-moved-ws=allow-indentation-change --color-moved=blocks HEAD^</pre></li>
</ol>
<ol class="simple"><li>In addition, you can view github-like diffs locally to identify what was changed within a code block using <tt class="docutils literal"><span class="pre">diff-highlight</span></tt> or <tt class="docutils literal"><span class="pre">diff-so-fancy</span></tt>, e.g.:<pre class="listing">
# put this in ~/.gitconfig:
[core]
  pager = &quot;diff-so-fancy | less -R&quot; # or: use: `diff-highlight`</pre></li>
</ol>

<h1><a class="toc-backref" id="documentation-style" href="#documentation-style">Documentation Style</a></h1>
<h2><a class="toc-backref" id="documentation-style-general-guidelines" href="#documentation-style-general-guidelines">General Guidelines</a></h2><ul class="simple"><li>See also <a class="reference external" href="https://nim-lang.github.io/Nim/nep1.html">nep1</a> which should probably be merged here.</li>
<li>Authors should document anything that is exported; documentation for private procs can be useful too (visible via <tt class="docutils literal"><span class="pre">nim doc --docInternal foo.nim</span></tt>).</li>
<li>Within documentation, a period (<tt class="docutils literal"><span class="pre">.</span></tt>) should follow each sentence (or sentence fragment) in a comment block. The documentation may be limited to one sentence fragment, but if multiple sentences are within the documentation, each sentence after the first should be complete and in present tense.</li>
<li>Documentation is parsed as a custom ReStructuredText (RST) with partial markdown support.</li>
<li>In nim sources, prefer single backticks to double backticks since it's simpler and <tt class="docutils literal"><span class="pre">nim doc</span></tt> supports it (even in rst files with <tt class="docutils literal"><span class="pre">nim rst2html</span></tt>).</li>
<li>In nim sources, for links, prefer <tt class="docutils literal"><span class="pre">[link text](link.html)</span></tt> to <pre class="listing"> `link text&lt;link.html&gt;`_ </pre> since the syntax is simpler and markdown is more common (likewise, <tt class="docutils literal"><span class="pre">nim rst2html</span></tt> also supports it in rst files).</li>
</ul>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">someproc</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">foo</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">## Use single backticks for inline code, eg: `s` or `someExpr(true)`.</span>
  <span class="Comment">## Use a backlash to follow with alphanumeric char: `int8`\s are great.</span></pre>
<h2><a class="toc-backref" id="documentation-style-moduleminuslevel-documentation" href="#documentation-style-moduleminuslevel-documentation">Module-level documentation</a></h2><p>Documentation of a module is placed at the top of the module itself. Each line of documentation begins with double hashes (<tt class="docutils literal"><span class="pre">##</span></tt>). Sometimes <tt class="docutils literal"><span class="pre">##[ multiline docs containing code ]##</span></tt> is preferable, see <tt class="docutils literal"><span class="pre">lib/pure/times.nim</span></tt>. Code samples are encouraged, and should follow the general RST syntax:</p>
<pre class="listing"><span class="Comment">## The `universe` module computes the answer to life, the universe, and everything.</span>
<span class="Comment">##</span>
<span class="Comment">## .. code-block::</span>
<span class="Comment">##  doAssert computeAnswerString() == 42</span></pre><p>Within this top-level comment, you can indicate the authorship and copyright of the code, which will be featured in the produced documentation.</p>
<pre class="listing"><span class="Comment">## This is the best module ever. It provides answers to everything!</span>
<span class="Comment">##</span>
<span class="Comment">## :Author: Steve McQueen</span>
<span class="Comment">## :Copyright: 1965</span>
<span class="Comment">##</span></pre><p>Leave a space between the last line of top-level documentation and the beginning of Nim code (the imports, etc.).</p>

<h2><a class="toc-backref" id="documentation-style-procs-templates-macros-converters-and-iterators" href="#documentation-style-procs-templates-macros-converters-and-iterators">Procs, Templates, Macros, Converters, and Iterators</a></h2><p>The documentation of a procedure should begin with a capital letter and should be in present tense. Variables referenced in the documentation should be surrounded by single tick marks:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">example1</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">## Prints the value of `x`.</span>
  <span class="Identifier">echo</span> <span class="Identifier">x</span></pre><p>Whenever an example of usage would be helpful to the user, you should include one within the documentation in RST format as below.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">addThree</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">,</span> <span class="Identifier">z</span><span class="Punctuation">:</span> <span class="Identifier">int8</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span>
  <span class="Comment">## Adds three `int8` values, treating them as unsigned and</span>
  <span class="Comment">## truncating the result.</span>
  <span class="Comment">##</span>
  <span class="Comment">## .. code-block::</span>
  <span class="Comment">##  # things that aren't suitable for a `runnableExamples` go in code-block:</span>
  <span class="Comment">##  echo execCmdEx(&quot;git pull&quot;)</span>
  <span class="Comment">##  drawOnScreen()</span>
  <span class="Identifier">runnableExamples</span><span class="Punctuation">:</span>
    <span class="Comment"># `runnableExamples` is usually preferred to `code-block`, when possible.</span>
    <span class="Identifier">doAssert</span> <span class="Identifier">addThree</span><span class="Punctuation">(</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">125</span><span class="Punctuation">,</span> <span class="DecNumber">6</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Operator">-</span><span class="DecNumber">122</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">x</span> <span class="Operator">+%</span> <span class="Identifier">y</span> <span class="Operator">+%</span> <span class="Identifier">z</span></pre><p>The commands <tt class="docutils literal"><span class="pre">nim doc</span></tt> and <tt class="docutils literal"><span class="pre">nim doc2</span></tt> will then correctly syntax highlight the Nim code within the documentation.</p>

<h2><a class="toc-backref" id="documentation-style-types" href="#documentation-style-types">Types</a></h2><p>Exported types should also be documented. This documentation can also contain code samples, but those are better placed with the functions to which they refer.</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span> <span class="Comment">## Provides a linked data structure with names</span>
                          <span class="Comment">## throughout. It is named for convenience. I'm making</span>
                          <span class="Comment">## this comment long to show how you can, too.</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span> <span class="Comment">## The name of the item</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span> <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre><p>You have some flexibility when placing the documentation:</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Comment">## Provides a linked data structure with names</span>
    <span class="Comment">## throughout. It is named for convenience. I'm making</span>
    <span class="Comment">## this comment long to show how you can, too.</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span> <span class="Comment">## The name of the item</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span> <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre><p>Make sure to place the documentation beside or within the object.</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Comment">## Bad: this documentation disappears because it annotates the ``type`` keyword</span>
  <span class="Comment">## above, not ``NamedQueue``.</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span> <span class="Comment">## This becomes the main documentation for the object, which</span>
                  <span class="Comment">## is not what we want.</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span> <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre>
<h2><a class="toc-backref" id="documentation-style-var-let-and-const" href="#documentation-style-var-let-and-const">Var, Let, and Const</a></h2><p>When declaring module-wide constants and values, documentation is encouraged. The placement of doc comments is similar to the <tt class="docutils literal"><span class="pre">type</span></tt> sections.</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">X</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="DecNumber">42</span> <span class="Comment">## An awesome number.</span>
  <span class="Identifier">SpreadArray</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span><span class="DecNumber">2</span><span class="Punctuation">,</span><span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
    <span class="Punctuation">[</span><span class="DecNumber">2</span><span class="Punctuation">,</span><span class="DecNumber">3</span><span class="Punctuation">,</span><span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
    <span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span><span class="DecNumber">1</span><span class="Punctuation">,</span><span class="DecNumber">2</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
  <span class="Punctuation">]</span> <span class="Comment">## Doc comment for ``SpreadArray``.</span></pre><p>Placement of comments in other areas is usually allowed, but will not become part of the documentation output and should therefore be prefaced by a single hash (<tt class="docutils literal"><span class="pre">#</span></tt>).</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">BadMathVals</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="FloatNumber">3.14</span><span class="Punctuation">,</span> <span class="Comment"># pi</span>
    <span class="FloatNumber">2.72</span><span class="Punctuation">,</span> <span class="Comment"># e</span>
    <span class="FloatNumber">0.58</span><span class="Punctuation">,</span> <span class="Comment"># gamma</span>
  <span class="Punctuation">]</span> <span class="Comment">## A bunch of badly rounded values.</span></pre><p>Nim supports Unicode in comments, so the above can be replaced with the following:</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">BadMathVals</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="FloatNumber">3.14</span><span class="Punctuation">,</span> <span class="Comment"># </span>
    <span class="FloatNumber">2.72</span><span class="Punctuation">,</span> <span class="Comment"># e</span>
    <span class="FloatNumber">0.58</span><span class="Punctuation">,</span> <span class="Comment"># </span>
  <span class="Punctuation">]</span> <span class="Comment">## A bunch of badly rounded values (including !).</span></pre>
<h1><a class="toc-backref" id="evolving-the-stdlib" href="#evolving-the-stdlib">Evolving the stdlib</a></h1><p>As outlined in <a class="reference external" href="https://github.com/nim-lang/RFCs/issues/173">https://github.com/nim-lang/RFCs/issues/173</a> there are a couple of guidelines about what should go into the stdlib, what should be added and what eventually should be removed.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib" href="#evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib">What the compiler itself needs must be part of the stdlib</a></h2><p>Maybe in the future the compiler itself can depend on Nimble packages but for the time being, we strive to have zero dependencies in the compiler as the compiler is the root of the bootstrapping process and is also used to build Nimble.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib" href="#evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib">Vocabulary types must be part of the stdlib</a></h2><p>These are types most packages need to agree on for better interoperability, for example <tt class="docutils literal"><span class="pre">Option[T]</span></tt>. This rule also covers the existing collections like <tt class="docutils literal"><span class="pre">Table</span></tt>, <tt class="docutils literal"><span class="pre">CountTable</span></tt> etc. &quot;Sorted&quot; containers based on a tree-like data structure are still missing and should be added.</p>
<p>Time handling, especially the <tt class="docutils literal"><span class="pre">Time</span></tt> type are also covered by this rule.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-existing-battleminustested-modules-stay" href="#evolving-the-stdlib-existing-battleminustested-modules-stay">Existing, battle-tested modules stay</a></h2><p>Reason: There is no benefit in moving them around just to fullfill some design fashion as in &quot;Nim's core MUST BE SMALL&quot;. If you don't like an existing module, don't import it. If a compilation target (e.g. JS) cannot support a module, document this limitation.</p>
<p>This covers modules like <tt class="docutils literal"><span class="pre">os</span></tt>, <tt class="docutils literal"><span class="pre">osproc</span></tt>, <tt class="docutils literal"><span class="pre">strscans</span></tt>, <tt class="docutils literal"><span class="pre">strutils</span></tt>, <tt class="docutils literal"><span class="pre">strformat</span></tt>, etc.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules" href="#evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules">Syntactic helpers can start as experimental stdlib modules</a></h2><p>Reason: Generally speaking as external dependencies they are not exposed to enough users so that we can see if the shortcuts provide enough benefit or not. Many programmers avoid external dependencies, even moreso for &quot;tiny syntactic improvements&quot;. However, this is only true for really good syntactic improvements that have the potential to clean up other parts of the Nim library substantially. If in doubt, new stdlib modules should start as external, successful Nimble packages.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules" href="#evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules">Other new stdlib modules do not start as stdlib modules</a></h2><p>As we strive for higher quality everywhere, it's easier to adopt existing, battle-tested modules eventually rather than creating modules from scratch.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-little-additions-are-acceptable" href="#evolving-the-stdlib-little-additions-are-acceptable">Little additions are acceptable</a></h2><p>As long as they are documented and tested well, adding little helpers to existing modules is acceptable. For two reasons:</p>
<ol class="simple"><li>It makes Nim easier to learn and use in the long run. (&quot;Why does sequtils lack a <tt class="docutils literal"><span class="pre">countIt</span></tt>? Because version 1.0 happens to have lacked it? Silly...&quot;)</li>
<li>To encourage contributions. Contributors often start with PRs that add simple things and then they stay and also fix bugs. Nim is an open source project and lives from people's contributions and involvement. Newly introduced issues have to be balanced against motivating new people. We know where to find perfectly designed pieces of software that have no bugs -- these are the systems that nobody uses.</li>
</ol>
</p>
  
  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2020-08-28 00:58:55 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
